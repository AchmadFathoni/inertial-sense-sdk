<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDK: src/ISBootloaderISB.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="IS_LOGO_BLACK_F03_email_signature.png"/></td>
  <td id="projectalign">
   <div id="projectname">SDK<span id="projectnumber">&#160;Release 1.9.0</span>
   </div>
   <div id="projectbrief">Communications, logger, and bootloader libraries.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">ISBootloaderISB.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="_i_s_bootloader_i_s_b_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span> </div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">/*</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">MIT LICENSE</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"></span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">Copyright (c) 2014-2022 Inertial Sense, Inc. - http://inertialsense.com</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"></span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files(the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions :</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"></span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"></span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">*/</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="_i_s_bootloader_i_s_b_8h.html">ISBootloaderISB.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="_i_s_utilities_8h.html">ISUtilities.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespace_i_s_bootloader.html">ISBootloader</a>;</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span> </div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>std::vector&lt;uint32_t&gt; cISBootloaderISB::serial_list;</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>std::vector&lt;uint32_t&gt; cISBootloaderISB::rst_serial_list;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>std::mutex cISBootloaderISB::serial_list_mutex;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>std::mutex cISBootloaderISB::rst_serial_list_mutex;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">// Delete this and assocated code in Q4 2022 after bootloader v5a is out of circulation. WHJ</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#a086849981aa367846f8c7fbe29e4cc34">   34</a></span><span class="preprocessor">#define SUPPORT_BOOTLOADER_V5A</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#a9be7e1b986a632f484f90d4a62b93489">   37</a></span><span class="preprocessor">#define IS_BAUD_RATE_BOOTLOADER 921600</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#a94bf881abdc00f884f3580b5b7823ede">   39</a></span><span class="preprocessor">#define BOOTLOADER_RETRIES          10</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#ae9af5fb05b7c83d516ab4683ca1faf86">   40</a></span><span class="preprocessor">#define BOOTLOADER_RESPONSE_DELAY   10</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#a36f9c553bf1daf7c7df99886e2f0eaa0">   41</a></span><span class="preprocessor">#define BOOTLOADER_REFRESH_DELAY    500</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#a4c548c41044465fad00d24c99eeced77">   42</a></span><span class="preprocessor">#define MAX_VERIFY_CHUNK_SIZE       1024</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#a377d602dd57c98be59f66efafe93a924">   43</a></span><span class="preprocessor">#define BOOTLOADER_TIMEOUT_DEFAULT  1000</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#a5ec11ef11aace0f302a1ea711388a28b">   44</a></span><span class="preprocessor">#define MAX_SEND_COUNT              510</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="comment">// logical page size, offsets for pages are 0x0000 to 0xFFFF - flash page size on devices will vary and is not relevant to the bootloader client</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">   47</a></span><span class="preprocessor">#define FLASH_PAGE_SIZE 65536</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#a8449e25b750d909130a2a85ac9530f14">   49</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#a8449e25b750d909130a2a85ac9530f14">cISBootloaderISB::match_test</a>(<span class="keywordtype">void</span>* param)</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>{</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="keyword">const</span> <span class="keywordtype">char</span>* serial_name = (<span class="keyword">const</span> <span class="keywordtype">char</span>*)param;</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="keywordflow">if</span>(strnlen(serial_name, 100) != 0 &amp;&amp; strncmp(serial_name, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>-&gt;<a class="code hl_variable" href="structserial__port__t.html#ae78066c31c9a5100228570d53e7fbec5">port</a>, 100) == 0)</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    {</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    }</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>}</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#a6efb9ac812178df4804179d6232e2d32">   61</a></span><a class="code hl_enumeration" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2">eImageSignature</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#a6efb9ac812178df4804179d6232e2d32">cISBootloaderISB::check_is_compatible</a>()</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>{</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <a class="code hl_function" href="serial_port_8c.html#af4b519e1c32d49d8937677b4b62ea99d">serialPortFlush</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>);</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <span class="comment">// if(</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#aed4542322cadca025f0bcf58be54c02a">sync</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>); </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>        <span class="comment">// != IS_OP_OK)</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="comment">// {</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="comment">//     for(int i = 0; i &lt; 10; i++)</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="comment">//     {</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="comment">//         // Reset the device</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="comment">//         if(serialPortWrite(m_port, (unsigned char*)&quot;:020000040500F5&quot;, 15) == 15)</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="comment">//         {</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <span class="comment">//             break;</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="comment">//         }</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="comment">//         SLEEP_MS(10);</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">//     }</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span> </div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="comment">//     return IS_IMAGE_SIGN_ERROR;</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <span class="comment">// }</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <a class="code hl_define" href="_i_s_utilities_8h.html#a038783cd27cbb54e9c8d8708f147168e">SLEEP_MS</a>(100);</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    <span class="comment">// Send command</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <a class="code hl_function" href="serial_port_8c.html#af4b519e1c32d49d8937677b4b62ea99d">serialPortFlush</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>);</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>, (uint8_t*)<span class="stringliteral">&quot;:020000041000EA&quot;</span>, 15);</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span> </div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    uint8_t buf[14] = { 0 };</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="comment">// Read Version, SAM-BA Available, serial number (in version 6+) and ok (.\r\n) response</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="keywordtype">int</span> count = <a class="code hl_function" href="serial_port_8c.html#a7426c48831273ec45889f652623d00df">serialPortReadTimeout</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>, buf, 14, 100);</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    uint32_t valid_signatures = 0;</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span> </div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="keywordflow">if</span> (count &lt; 8 || buf[0] != 0xAA || buf[1] != 0x55)</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    {   <span class="comment">// Bad read</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a890a0460e8a110e1ee31c8e729fb1d31">IS_IMAGE_SIGN_NONE</a>;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    }</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> = buf[2];</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a> = (char)buf[3];</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="comment">//    bool rom_available = buf[4];</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    uint8_t <a class="code hl_variable" href="classc_i_s_bootloader_i_s_b.html#a21f99422a8fd1cfb15302119cd701040">processor</a> = 0xFF;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    m_isb_props.is_evb = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#aa7df04cbf82eb979e701f66fa0e76b5a">m_sn</a> = 0;</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <span class="keywordflow">if</span>(buf[11] == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; buf[12] == <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; buf[13] == <span class="charliteral">&#39;\n&#39;</span>)</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    {</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>        <a class="code hl_variable" href="classc_i_s_bootloader_i_s_b.html#a21f99422a8fd1cfb15302119cd701040">processor</a> = (<a class="code hl_enumeration" href="namespace_i_s_bootloader.html#a80a59119a7a9a9b8675b4b7a31cf5ba6">eProcessorType</a>)buf[5];</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        m_isb_props.is_evb = buf[6];</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>        memcpy(&amp;<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#aa7df04cbf82eb979e701f66fa0e76b5a">m_sn</a>, &amp;buf[7], <span class="keyword">sizeof</span>(uint32_t));</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    }</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span> </div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> &gt;= 6)   </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    {   <span class="comment">// v6 and up has EVB detection built-in</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>        <span class="keywordflow">if</span>(<a class="code hl_variable" href="classc_i_s_bootloader_i_s_b.html#a21f99422a8fd1cfb15302119cd701040">processor</a> == <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a80a59119a7a9a9b8675b4b7a31cf5ba6ada8b6a1944bdcffbd13c86732ded6b84">IS_PROCESSOR_SAMx70</a>)</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        {   </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>            valid_signatures |= m_isb_props.is_evb ? <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a08be4861f1cb10537584ee03f649906c">IS_IMAGE_SIGN_EVB_2_24K</a> : <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a21a7f735341610339d34fa49762357a0">IS_IMAGE_SIGN_UINS_3_24K</a>;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>            valid_signatures |= <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2af101394417d121c078a4056c5aae9651">IS_IMAGE_SIGN_ISB_SAMx70_16K</a> | <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a8d81bf1df4e358eb283f577f9738dc1b">IS_IMAGE_SIGN_ISB_SAMx70_24K</a>;</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>        }</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code hl_variable" href="classc_i_s_bootloader_i_s_b.html#a21f99422a8fd1cfb15302119cd701040">processor</a> == <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a80a59119a7a9a9b8675b4b7a31cf5ba6af7b5cee53c43708d1eba5a8bed0d120c">IS_PROCESSOR_STM32L4</a>)</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>            valid_signatures |= <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2aedaebacf879f9f8dd45d02421b93edd0">IS_IMAGE_SIGN_UINS_5</a>;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>            valid_signatures |= <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2afe5985f982c044f693cc6140a4815462">IS_IMAGE_SIGN_ISB_STM32L4</a>;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>        }</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    }</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    {</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>        valid_signatures |= <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a48ec64d1b2f09273e78b930b18e0c10f">IS_IMAGE_SIGN_EVB_2_16K</a> | <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a51902124186404747dd01bf070335611">IS_IMAGE_SIGN_UINS_3_16K</a>;</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>        valid_signatures |= <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2af101394417d121c078a4056c5aae9651">IS_IMAGE_SIGN_ISB_SAMx70_16K</a> | <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a8d81bf1df4e358eb283f577f9738dc1b">IS_IMAGE_SIGN_ISB_SAMx70_24K</a>;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    }</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="keywordflow">return</span> (<a class="code hl_enumeration" href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2">eImageSignature</a>)valid_signatures;</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>}</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#ac4ff1b5dd6003b735be8762bfcfbfd7e">  136</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#ac4ff1b5dd6003b735be8762bfcfbfd7e">cISBootloaderISB::reboot_up</a>()</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>{</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a5dd3052c83e7c7aa84d17579aaba6d49">m_info_callback</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;(ISB) Rebooting up into APP mode...&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="comment">// send the &quot;reboot to program mode&quot; command and the device should start in program mode</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;:020000040300F7&quot;</span>, 15);</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <a class="code hl_function" href="serial_port_8c.html#a25ebaeafcc060a447ec1a38a8085943d">serialPortClose</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>);</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>}</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span> </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#a2af077bc4a546b9b5d47f12aa1378a37">  146</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#a2af077bc4a546b9b5d47f12aa1378a37">cISBootloaderISB::reboot_down</a>(uint8_t major, <span class="keywordtype">char</span> minor, <span class="keywordtype">bool</span> force)</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>{</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <span class="keywordtype">char</span> message[100] = {0};</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span> </div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="keywordflow">if</span>(!force)</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    {   </div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        <span class="keywordflow">if</span>(major != 0 &amp;&amp; minor != 0)</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            <span class="keywordflow">if</span>(major &lt; <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a>)</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>            {</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>(message, 100, <span class="stringliteral">&quot;(ISB) Not updating bootloader: file %c%c, device %c%c&quot;</span>, major + <span class="charliteral">&#39;0&#39;</span>, minor, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> + <span class="charliteral">&#39;0&#39;</span>, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a>);</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>                <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a5dd3052c83e7c7aa84d17579aaba6d49">m_info_callback</a>(<span class="keyword">this</span>, message, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>            }</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(major == <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a>)</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            {</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>                <span class="keywordflow">if</span>(minor &lt; <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a>)</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>                {</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>                    <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>(message, 100, <span class="stringliteral">&quot;(ISB) Not updating bootloader: file %c%c, device %c%c&quot;</span>, major + <span class="charliteral">&#39;0&#39;</span>, minor, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> + <span class="charliteral">&#39;0&#39;</span>, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a>);</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>                    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a5dd3052c83e7c7aa84d17579aaba6d49">m_info_callback</a>(<span class="keyword">this</span>, message, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>                    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>                }</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(minor == <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a>)</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>                {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>                    <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>(message, 100, <span class="stringliteral">&quot;(ISB) Not updating bootloader: file %c%c, device %c%c&quot;</span>, major + <span class="charliteral">&#39;0&#39;</span>, minor, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> + <span class="charliteral">&#39;0&#39;</span>, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a>);</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a5dd3052c83e7c7aa84d17579aaba6d49">m_info_callback</a>(<span class="keyword">this</span>, message, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>                    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                }</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            }</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        }</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        {</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        }</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    }</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    {</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>(message, 100, <span class="stringliteral">&quot;(ISB) Updating bootloader: file %c%c &gt;&gt; device %c%c&quot;</span>, major + <span class="charliteral">&#39;0&#39;</span>, minor, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> + <span class="charliteral">&#39;0&#39;</span>, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a>);</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a5dd3052c83e7c7aa84d17579aaba6d49">m_info_callback</a>(<span class="keyword">this</span>, message, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    }</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span> </div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a5dd3052c83e7c7aa84d17579aaba6d49">m_info_callback</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;(ISB) Rebooting down into DFU/SAMBA mode...&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="comment">// USE WITH CAUTION! This will put in bootloader ROM mode allowing a new bootloader to be put on</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">// In some cases, the device may become unrecoverable because of interference on its ports.</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span> </div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="comment">// restart bootloader assist command</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;:020000040700F3&quot;</span>, 15);</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span> </div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>}</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#a40149f71f4c103772dfba7c15e784a95">  199</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#a40149f71f4c103772dfba7c15e784a95">cISBootloaderISB::reboot_force</a>()</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>{</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="comment">// restart bootloader command</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;:020000040500F5&quot;</span>, 15) != 15)</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    {</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    }</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>   </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>}</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#accf8ffbc948927a3779851c520f2bf99">  210</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#accf8ffbc948927a3779851c520f2bf99">cISBootloaderISB::reboot</a>()</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>{</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    rst_serial_list_mutex.lock();</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="keywordflow">if</span>(find(rst_serial_list.begin(), rst_serial_list.end(), <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#aa7df04cbf82eb979e701f66fa0e76b5a">m_sn</a>) != rst_serial_list.end())</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    {</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        rst_serial_list_mutex.unlock();</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    }</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span> </div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a5dd3052c83e7c7aa84d17579aaba6d49">m_info_callback</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;(ISB) Resetting before App update...&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="comment">// restart bootloader command</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#a40149f71f4c103772dfba7c15e784a95">reboot_force</a>() == <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    {</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>        rst_serial_list.push_back(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#aa7df04cbf82eb979e701f66fa0e76b5a">m_sn</a>);</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>        rst_serial_list_mutex.unlock();</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    }</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span> </div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    rst_serial_list_mutex.unlock();</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a0be7fb64dcc83728e690665d5c55c7dd">IS_OP_CLOSED</a>;</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>}</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span> </div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#afa1f47550416d2c71b4f0df83c6bf33c">  235</a></span>uint32_t <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#afa1f47550416d2c71b4f0df83c6bf33c">cISBootloaderISB::get_device_info</a>()</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>{</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#aed4542322cadca025f0bcf58be54c02a">sync</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    <a class="code hl_function" href="serial_port_8c.html#af4b519e1c32d49d8937677b4b62ea99d">serialPortFlush</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>);</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <span class="comment">// Send command</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>, (uint8_t*)<span class="stringliteral">&quot;:020000041000EA&quot;</span>, 15);</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span> </div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    uint8_t buf[14] = { 0 };</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="comment">// Read Version, SAM-BA Available, serial number (in version 6+) and ok (.\r\n) response</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    <span class="keywordtype">int</span> count = <a class="code hl_function" href="serial_port_8c.html#a7426c48831273ec45889f652623d00df">serialPortReadTimeout</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>, buf, 14, 1000);</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    <span class="keywordflow">if</span> (count &lt; 8 || buf[0] != 0xAA || buf[1] != 0x55)</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    {   <span class="comment">// Bad read</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> = 0;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a> = 0;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        m_isb_props.rom_available = 1;</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>        m_isb_props.processor = <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a80a59119a7a9a9b8675b4b7a31cf5ba6ada8b6a1944bdcffbd13c86732ded6b84">IS_PROCESSOR_SAMx70</a>;</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>        m_isb_props.is_evb = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#aa7df04cbf82eb979e701f66fa0e76b5a">m_sn</a> = 0;</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    }</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> = buf[2];</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">m_isb_minor</a> = (char)buf[3];</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    m_isb_props.rom_available = buf[4];</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    <span class="keywordflow">if</span>(buf[11] == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; buf[12] == <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; buf[13] == <span class="charliteral">&#39;\n&#39;</span>)</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>        m_isb_props.processor = (<a class="code hl_enumeration" href="namespace_i_s_bootloader.html#a80a59119a7a9a9b8675b4b7a31cf5ba6">eProcessorType</a>)buf[5];</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        m_isb_props.is_evb = buf[6];</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        memcpy(&amp;<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#aa7df04cbf82eb979e701f66fa0e76b5a">m_sn</a>, &amp;buf[7], <span class="keyword">sizeof</span>(uint32_t));</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    }</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    {</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#aa7df04cbf82eb979e701f66fa0e76b5a">m_sn</a> = 0;</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    }</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> == 1)</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    {   <span class="comment">// version 1</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        m_isb_props.app_offset = 8192;</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    }</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> &gt;= 2 &amp;&amp; <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> &lt;= 5)</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    {   <span class="comment">// version 2, 3 (which sent v2), 4, 5</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>        m_isb_props.app_offset = 16384;</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    }</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">m_isb_major</a> &gt;= 6)</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    {   <span class="comment">// version 6</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        m_isb_props.app_offset = 24576;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    }</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    {</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    }</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span><span class="preprocessor">#if PLATFORM_IS_WINDOWS</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <span class="comment">// EvalTool and multiple bootloads under Windows 10 have issues with dropped data if verify runs too fast</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    m_isb_props.verify_size = 125;</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    m_isb_props.verify_size = <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4c548c41044465fad00d24c99eeced77">MAX_VERIFY_CHUNK_SIZE</a>;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span> </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>}</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span> </div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#aed4542322cadca025f0bcf58be54c02a">  301</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#aed4542322cadca025f0bcf58be54c02a">cISBootloaderISB::sync</a>(<a class="code hl_struct" href="structserial__port__t.html">serial_port_t</a>* s)</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>{</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <span class="keyword">static</span> <span class="keyword">const</span> uint8_t handshakerChar = <span class="charliteral">&#39;U&#39;</span>;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    <span class="comment">// write a &#39;U&#39; to handshake with the boot loader - once we get a &#39;U&#39; back we are ready to go</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a94bf881abdc00f884f3580b5b7823ede">BOOTLOADER_RETRIES</a>; i++)</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    {</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>        <span class="keywordflow">if</span>(<a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(s, &amp;handshakerChar, 1) != 1)</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>        }</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#aaef9e6973f9dfd121a4eb87b7a13542e">serialPortWaitForTimeout</a>(s, &amp;handshakerChar, 1, <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#ae9af5fb05b7c83d516ab4683ca1faf86">BOOTLOADER_RESPONSE_DELAY</a>))</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>        {   <span class="comment">// Success</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        }</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    }</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="preprocessor">#if defined(SUPPORT_BOOTLOADER_V5A)     </span><span class="comment">// ONLY NEEDED TO SUPPORT BOOTLOADER v5a.  Delete this and assocated code in Q4 2022 after bootloader v5a is out of circulation. WHJ</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> handshaker[] = <span class="stringliteral">&quot;INERTIAL_SENSE_SYNC_DFU&quot;</span>;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    <span class="comment">// Attempt handshake using extended string for bootloader v5a</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a94bf881abdc00f884f3580b5b7823ede">BOOTLOADER_RETRIES</a>; i++)</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    {</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#a315998701c41541c53f4041b4e3f8403">serialPortWriteAndWaitForTimeout</a>(s, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)&amp;handshaker, (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(handshaker), &amp;handshakerChar, 1, <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#ae9af5fb05b7c83d516ab4683ca1faf86">BOOTLOADER_RESPONSE_DELAY</a>))</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        {   <span class="comment">// Success</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>        }</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    }</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>}</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span><span class="keywordtype">int</span> cISBootloaderISB::checksum(<span class="keywordtype">int</span> checkSum, uint8_t* ptr, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> end, <span class="keywordtype">int</span> checkSumPosition, <span class="keywordtype">int</span> finalCheckSum)</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>{</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    uint8_t c1, c2;</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    uint8_t* currentPtr = (uint8_t*)(ptr + start);</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    uint8_t* endPtr = (uint8_t*)(ptr + end - 1);</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    uint8_t b;</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    <span class="keywordflow">while</span> (currentPtr &lt; endPtr)</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>        c1 = *(currentPtr++) | 0x20;</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>        c1 = (c1 &lt;= <span class="charliteral">&#39;9&#39;</span> ? c1 + 0xD0 : c1 + 0xA9);</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>        c2 = *(currentPtr++) | 0x20;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        c2 = (c2 &lt;= <span class="charliteral">&#39;9&#39;</span> ? c2 + 0xD0 : c2 + 0xA9);</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        b = (c1 &lt;&lt; 4) | c2;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>        checkSum += b;</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    }</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span> </div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <span class="keywordflow">if</span> (finalCheckSum) checkSum = (uint8_t)(~checkSum + 1);</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="keywordflow">if</span> (checkSumPosition != 0) <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>((<span class="keywordtype">char</span>*)(ptr + checkSumPosition), 3, <span class="stringliteral">&quot;%.2X&quot;</span>, checkSum);</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span> </div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="keywordflow">return</span> checkSum;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>}</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> cISBootloaderISB::erase_flash()</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>{</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <span class="comment">// give the device 60 seconds to erase flash before giving up</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> eraseFlashTimeoutMilliseconds = 60000;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> selectFlash[24];</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <a class="code hl_struct" href="structserial__port__t.html">serial_port_t</a>* s = <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span> </div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="comment">// Write location to erase at</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    memcpy(selectFlash, <span class="stringliteral">&quot;:03000006030000F4CC\0\0\0\0\0&quot;</span>, 24);</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    checksum(0, selectFlash, 1, 17, 17, 1);</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#a315998701c41541c53f4041b4e3f8403">serialPortWriteAndWaitForTimeout</a>(s, selectFlash, 19, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;.\r\n&quot;</span>, 3, <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a377d602dd57c98be59f66efafe93a924">BOOTLOADER_TIMEOUT_DEFAULT</a>) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    <span class="comment">// Erase</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    memcpy(selectFlash, <span class="stringliteral">&quot;:0200000400FFFBCC\0&quot;</span>, 18);</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    checksum(0, selectFlash, 1, 15, 15, 1);</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#a315998701c41541c53f4041b4e3f8403">serialPortWriteAndWaitForTimeout</a>(s, selectFlash, 17, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;.\r\n&quot;</span>, 3, eraseFlashTimeoutMilliseconds) == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span> </div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>}</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> cISBootloaderISB::select_page(<span class="keywordtype">int</span> page)</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>{</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <a class="code hl_struct" href="structserial__port__t.html">serial_port_t</a>* s = <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>;</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="comment">// Atmel select page command (0x06) is 4 bytes and the data is always 0301xxxx where xxxx is a 16 bit page number in hex</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> changePage[24];</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="comment">// Change page</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>((<span class="keywordtype">char</span>*)changePage, 24, <span class="stringliteral">&quot;:040000060301%.4XCC&quot;</span>, page);</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    checksum(0, changePage, 1, 17, 17, 1);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#a315998701c41541c53f4041b4e3f8403">serialPortWriteAndWaitForTimeout</a>(s, changePage, 19, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;.\r\n&quot;</span>, 3, <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a377d602dd57c98be59f66efafe93a924">BOOTLOADER_TIMEOUT_DEFAULT</a>) == 0) </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    {</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failed to select page&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    }</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>}</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span> </div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> cISBootloaderISB::begin_program_for_current_page(<span class="keywordtype">int</span> startOffset, <span class="keywordtype">int</span> endOffset)</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>{</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <a class="code hl_struct" href="structserial__port__t.html">serial_port_t</a>* s = <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span> </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="comment">// Atmel begin program command is 0x01, different from standard intel hex where command 0x01 is end of file</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    <span class="comment">// After the 0x01 is a 00 which means begin writing program</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <span class="comment">// The begin program command uses the current page and specifies two 16 bit addresses that specify where in the current page</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="comment">//  the program code will be written</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> programPage[24];</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    </div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <span class="comment">// Select offset</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>((<span class="keywordtype">char</span>*)programPage, 24, <span class="stringliteral">&quot;:0500000100%.4X%.4XCC&quot;</span>, startOffset, endOffset);</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    checksum(0, programPage, 1, 19, 19, 1);</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#a315998701c41541c53f4041b4e3f8403">serialPortWriteAndWaitForTimeout</a>(s, programPage, 21, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<span class="stringliteral">&quot;.\r\n&quot;</span>, 3, <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a377d602dd57c98be59f66efafe93a924">BOOTLOADER_TIMEOUT_DEFAULT</a>) == 0)</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    {</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failed to start programming page&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    }</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>}</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span> </div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span><span class="keywordtype">int</span> cISBootloaderISB::is_isb_read_line(FILE* file, <span class="keywordtype">char</span> line[1024])</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>{</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <span class="keywordtype">char</span> c;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <span class="keywordtype">char</span>* currentPtr = line;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    <span class="keywordtype">char</span>* endPtr = currentPtr + 1023;</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="keywordflow">while</span> (currentPtr != endPtr)</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    {</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        <span class="comment">// read one char</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>        c = (char)fgetc(file);</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>        <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\r&#39;</span>) <span class="keywordflow">continue</span>;                        <span class="comment">// eat &#39;\r&#39; chars</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span> || c == (<span class="keywordtype">char</span>)EOF) <span class="keywordflow">break</span>;    <span class="comment">// newline char, we have a line</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>        *currentPtr++ = c;</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>    }</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span> </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    *currentPtr = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span> </div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <span class="comment">// TODO: Figure out why ARM64 bootloader hits this...</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    <span class="keywordflow">if</span> (currentPtr - line == 1023)</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    {</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    }</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(currentPtr - line);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>}</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> cISBootloaderISB::upload_hex_page(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* hexData, <span class="keywordtype">int</span> byteCount, <span class="keywordtype">int</span>* currentOffset, <span class="keywordtype">int</span>* totalBytes, <span class="keywordtype">int</span>* verifyCheckSum)</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>{</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <a class="code hl_struct" href="structserial__port__t.html">serial_port_t</a>* s = <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    <span class="keywordflow">if</span> (byteCount == 0)</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    }</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span> </div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    <span class="comment">// create a program request with just the hex characters that will fit on this page</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> programLine[12];</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>((<span class="keywordtype">char</span>*)programLine, 12, <span class="stringliteral">&quot;:%.2X%.4X00&quot;</span>, byteCount, *currentOffset);</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(s, programLine, 9) != 9)</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>    {</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failed to write start page&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    }</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span> </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>    <span class="comment">// add the previously written chars to the checksum</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    <span class="keywordtype">int</span> checkSum = checksum(0, programLine, 1, 9, 0, 0);</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    <span class="comment">// write all of the hex chars</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    <span class="keywordtype">int</span> charsForThisPage = byteCount * 2;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(s, hexData, charsForThisPage) != charsForThisPage)</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    {</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failed to write data to device&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    }</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <span class="keywordtype">int</span> newVerifyChecksum = *verifyCheckSum;</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span> </div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <span class="comment">// calculate verification checksum for this data</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; charsForThisPage; i++)</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    {</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        newVerifyChecksum = ((newVerifyChecksum &lt;&lt; 5) + newVerifyChecksum) + hexData[i];</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    }</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span> </div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    checkSum = checksum(checkSum, hexData, 0, charsForThisPage, 0, 1);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> checkSumHex[3];</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>((<span class="keywordtype">char</span>*)checkSumHex, 3, <span class="stringliteral">&quot;%.2X&quot;</span>, checkSum);</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span> </div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    <span class="comment">// For some reason, the checksum doesn&#39;t always make it through to the IMX-5. Re-send until we get a response or timeout.</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    <span class="comment">// Update 8/25/22: Increasing the serialPortReadTimeout from 10 to 100 seems to have fixed this. Still needs to be proven.</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 10; i++)</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    {</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(s, checkSumHex, 2) != 2)</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>        {</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>            <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failed to write checksum to device&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>        }</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span> </div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[5] = { 0 };</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        <span class="keywordtype">int</span> count = <a class="code hl_function" href="serial_port_8c.html#a7426c48831273ec45889f652623d00df">serialPortReadTimeout</a>(s, buf, 3, 1000);</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span> </div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>        <span class="keywordflow">if</span> (count == 3 &amp;&amp; memcmp(buf, <span class="stringliteral">&quot;.\r\n&quot;</span>, 3) == 0)</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>        {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        }</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>        <span class="comment">// Some debug code</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span><span class="comment">//        else if(count == 0)</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span><span class="comment">//        {</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="comment">//            continue;</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="comment">//        }</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="comment">//        else</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="comment">//        {</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span><span class="comment">//            continue;</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="comment">//        }</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        <span class="keywordflow">if</span> (i == 9)</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>        {</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>        }</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    }</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span> </div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span> </div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">//     if (serialPortWriteAndWaitForTimeout(s, checkSumHex, 2, (unsigned char*)&quot;.\r\n&quot;, 3, BOOTLOADER_TIMEOUT_DEFAULT) == 0)</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span><span class="comment">//     {</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="comment">//         status_update(&quot;(ISB) Failed to write checksum to device&quot;, IS_LOG_LEVEL_ERROR);</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="comment">//         return IS_OP_ERROR;</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="comment">//     }</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    *totalBytes += byteCount;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    *currentOffset += byteCount;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    *verifyCheckSum = newVerifyChecksum;</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>}</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span> </div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> cISBootloaderISB::upload_hex(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* hexData, <span class="keywordtype">int</span> charCount, <span class="keywordtype">int</span>* currentOffset, <span class="keywordtype">int</span>* currentPage, <span class="keywordtype">int</span>* totalBytes, <span class="keywordtype">int</span>* verifyCheckSum)</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>{</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    (void)currentPage;</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    <span class="keywordflow">if</span> (charCount &gt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a5ec11ef11aace0f302a1ea711388a28b">MAX_SEND_COUNT</a>)</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    {</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Unexpected char count&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    }</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (charCount == 0)</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    {</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    }</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span> </div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>    <span class="keywordtype">int</span> byteCount = charCount / 2;</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    <span class="comment">// check if we will overrun the current page</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>    <span class="keywordflow">if</span> (*currentOffset + byteCount &gt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a>)</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>    {</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>        <span class="keywordtype">int</span> pageByteCount = <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a> - *currentOffset;</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>         </div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        <span class="keywordflow">if</span> (upload_hex_page(hexData, pageByteCount, currentOffset, totalBytes, verifyCheckSum) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        {</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        }</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span> </div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        hexData += (pageByteCount * 2);</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        charCount -= (pageByteCount * 2);</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <span class="comment">// // change to the next page</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        <span class="comment">// *currentOffset = 0;</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>        <span class="comment">// (*currentPage)++;</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>        <span class="comment">// if (select_page(*currentPage) != IS_OP_OK || begin_program_for_current_page(0, FLASH_PAGE_SIZE - 1) != IS_OP_OK)</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>        <span class="comment">// {</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>        <span class="comment">//     status_update(&quot;(ISB) Failed to issue select page or to start programming&quot;, IS_LOG_LEVEL_ERROR);</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>        <span class="comment">//     return IS_OP_ERROR;</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        <span class="comment">// }</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    }</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="keywordflow">if</span> (charCount != 0 &amp;&amp; upload_hex_page(hexData, charCount / 2, currentOffset, totalBytes, verifyCheckSum) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    {</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    }</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span> </div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>}</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span> </div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> cISBootloaderISB::fill_current_page(<span class="keywordtype">int</span>* currentPage, <span class="keywordtype">int</span>* currentOffset, <span class="keywordtype">int</span>* totalBytes, <span class="keywordtype">int</span>* verifyCheckSum)</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>{</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    (void)currentPage;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="keywordflow">if</span> (*currentOffset &lt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a>)</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    {</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> hexData[256];</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>        memset(hexData, <span class="charliteral">&#39;F&#39;</span>, 256);</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span> </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>        <span class="keywordflow">while</span> (*currentOffset &lt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a>)</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        {</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>            <span class="keywordtype">int</span> byteCount = (<a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a> - *currentOffset) * 2;</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>            <span class="keywordflow">if</span> (byteCount &gt; 256)</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>            {</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>                byteCount = 256;</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>            }</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>            memset(hexData, <span class="charliteral">&#39;F&#39;</span>, byteCount);</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>            <span class="keywordflow">if</span> (upload_hex_page(hexData, byteCount / 2, currentOffset, totalBytes, verifyCheckSum) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>            {</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failed to fill page with bytes&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>            }</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>        }</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    }</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>}</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span> </div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> cISBootloaderISB::download_data(<span class="keywordtype">int</span> startOffset, <span class="keywordtype">int</span> endOffset)</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>{</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    <a class="code hl_struct" href="structserial__port__t.html">serial_port_t</a>* s = <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>;</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span> </div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>    <span class="comment">// Atmel download data command is 0x03, different from standard intel hex where command 0x03 is start segment address</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> programLine[24];</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <span class="keywordtype">int</span> n;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    n = <a class="code hl_define" href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a>((<span class="keywordtype">char</span>*)programLine, 24, <span class="stringliteral">&quot;:0500000300%.4X%.4XCC&quot;</span>, startOffset, endOffset);</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    programLine[n] = 0;</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>    checksum(0, programLine, 1, 19, 19, 1);</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a>(s, programLine, 21) != 21)</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    {</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failed to attempt download&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>    }</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span> </div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>}</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span> </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#a20abf8c77cb3ea4b04ba9adef741966e">  630</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#a20abf8c77cb3ea4b04ba9adef741966e">cISBootloaderISB::verify_image</a>(std::string filename)</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>{</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    <span class="keywordtype">int</span> verifyChunkSize = m_isb_props.verify_size;</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>    <span class="keywordtype">int</span> chunkSize = <a class="code hl_define" href="_i_s_constants_8h.html#a89279935d2e2d0bcdc26cdf9e2ba5b1e">_MIN</a>(<a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a>, verifyChunkSize);</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>    <span class="keywordtype">int</span> realCheckSum = 5381;</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    <span class="keywordtype">int</span> totalCharCount = m_isb_props.app_offset * 2;</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    <span class="keywordtype">int</span> grandTotalCharCount = (m_currentPage + 1) * <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a> * 2; <span class="comment">// char count</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <span class="keywordtype">int</span> i, pageOffset, readCount, actualPageOffset, pageChars, chunkIndex, lines;</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>    <span class="keywordtype">int</span> verifyByte = -1;</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> chunkBuffer[(<a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4c548c41044465fad00d24c99eeced77">MAX_VERIFY_CHUNK_SIZE</a> * 2) + 64]; <span class="comment">// extra space for overhead</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c=0;</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>    FILE* verifyFile = 0;</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8896f0fe990b381c6d4a3adc75702bbd">m_verify_progress</a> = 0.0f;</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    fopen_s(&amp;verifyFile, filename.c_str(), <span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    verifyFile = fopen(filename.c_str(), <span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span> </div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>    <span class="keywordflow">for</span> (i = 0; i &lt;= m_currentPage; i++)</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>    {</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>        <span class="keywordflow">if</span> (select_page(i) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        {</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>            <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failure issuing select page command for verify&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        }</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        pageOffset = (i == 0 ? m_isb_props.app_offset : 0);</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        <span class="keywordflow">while</span> (pageOffset &lt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a>)</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>        {</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>            readCount = <a class="code hl_define" href="_i_s_constants_8h.html#a89279935d2e2d0bcdc26cdf9e2ba5b1e">_MIN</a>(chunkSize, <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a> - pageOffset);</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span> </div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>            <span class="comment">// range is inclusive on the uINS, so subtract one</span></div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>            <span class="keywordflow">if</span> (download_data(pageOffset, pageOffset + readCount - 1) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>            {</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>                <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failure issuing download data command&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>            }</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>            <span class="comment">// each line has 7 overhead bytes, plus two bytes (hex) for each byte on the page and max 255 bytes per line</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>            lines = (int)ceilf((<span class="keywordtype">float</span>)readCount / 255.0f);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>            readCount = <a class="code hl_function" href="serial_port_8c.html#a7426c48831273ec45889f652623d00df">serialPortReadTimeout</a>(<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">m_port</a>, chunkBuffer, (7 * lines) + (readCount * 2), <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a377d602dd57c98be59f66efafe93a924">BOOTLOADER_TIMEOUT_DEFAULT</a>);</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>            chunkIndex = 0;</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span> </div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            <span class="keywordflow">while</span> (chunkIndex &lt; readCount)</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>            {</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>                <span class="keywordflow">if</span> (chunkIndex &gt; readCount - 5)</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>                {</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>                    <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Unexpected start line during verify (1)&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>                    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>                }</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>                <span class="comment">// skip the first 5 chars, they are simply ####=</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>                <span class="keywordflow">if</span> (chunkBuffer[chunkIndex] == <span class="charliteral">&#39;X&#39;</span>)</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>                {</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>                    <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Invalid checksum during verify&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>                    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>                }</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chunkBuffer[chunkIndex += 4] != <span class="charliteral">&#39;=&#39;</span>)</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>                {</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>                    <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Unexpected start line during verify (2)&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>                    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>                }</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>                chunkBuffer[chunkIndex] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>                actualPageOffset = strtol((<span class="keywordtype">char</span>*)(chunkBuffer + chunkIndex - 4), 0, 16);</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>                <span class="keywordflow">if</span> (actualPageOffset != pageOffset)</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>                {</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>                    <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Unexpected offset during verify&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>                    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>                }</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>                pageChars = 0;</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>                chunkIndex++;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>                <span class="keywordflow">while</span> (chunkIndex &lt; readCount)</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>                {</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>                    c = chunkBuffer[chunkIndex++];</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>                    <span class="keywordflow">if</span> ((c &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; c &lt;= <span class="charliteral">&#39;9&#39;</span>) || (c &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; c &lt;= <span class="charliteral">&#39;F&#39;</span>))</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>                    {</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>                        pageChars++;</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>                        totalCharCount++;</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>                        realCheckSum = ((realCheckSum &lt;&lt; 5) + realCheckSum) + c;</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span> </div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>                        <span class="keywordflow">if</span> (verifyFile != 0)</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>                        {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>                            <span class="keywordflow">if</span> (verifyByte == -1)</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>                            {</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>                                verifyByte = ((c &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; c &lt;= <span class="charliteral">&#39;9&#39;</span>) ? c - <span class="charliteral">&#39;0&#39;</span> : c - <span class="charliteral">&#39;A&#39;</span> + 10) &lt;&lt; 4;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>                            }</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>                            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>                            {</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>                                verifyByte |= (c &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; c &lt;= <span class="charliteral">&#39;9&#39;</span>) ? c - <span class="charliteral">&#39;0&#39;</span> : c - <span class="charliteral">&#39;A&#39;</span> + 10;</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>                                fputc(verifyByte, verifyFile);</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>                                verifyByte = -1;</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                            }</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                        }</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                    }</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\r&#39;</span>)</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>                    {</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>                    }</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span>)</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>                    {</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                    }</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>                    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>                    {</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>                        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Unexpected hex data during verify&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>                        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                    }</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                }</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span> </div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>                <span class="keywordflow">if</span> (c != <span class="charliteral">&#39;\n&#39;</span>)</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>                {</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>                    <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Unexpected end of line char during verify&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>                    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>                }</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span> </div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>                <span class="comment">// increment page offset</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>                pageOffset += (pageChars / 2);</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span> </div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a6fe1da33fc0010a08a7c2670e95d7827">m_verify_callback</a> != 0)</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>                {</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>                    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8896f0fe990b381c6d4a3adc75702bbd">m_verify_progress</a> = (float)totalCharCount / (<span class="keywordtype">float</span>)grandTotalCharCount;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a6fe1da33fc0010a08a7c2670e95d7827">m_verify_callback</a>(<span class="keyword">this</span>, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8896f0fe990b381c6d4a3adc75702bbd">m_verify_progress</a>) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>                    {</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>                        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Firmware validate cancelled&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a55a8bca4ef283118639d8063b715a579">IS_OP_CANCELLED</a>;</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>                    }</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>                }</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>            }</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>        }</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    }</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span> </div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    <span class="keywordflow">if</span> (verifyFile != 0)</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>    {</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>        fclose(verifyFile);</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    }</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>    <span class="keywordflow">if</span> (realCheckSum != m_verifyCheckSum)</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    {</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>        <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Checksum mismatch during verify&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>    }</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span> </div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>}</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span> </div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno"><a class="line" href="_i_s_bootloader_i_s_b_8cpp.html#adb4412489ec48d32c2afeece07926ae7">  776</a></span><span class="preprocessor">#define HEX_BUFFER_SIZE 1024</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span> </div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> cISBootloaderISB::process_hex_file(FILE* file)</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>{</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>    <span class="keywordtype">int</span> currentPage = -1;</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>    <span class="keywordtype">int</span> currentOffset = m_isb_props.app_offset;</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>    <span class="keywordtype">int</span> lastSubOffset = currentOffset;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>    <span class="keywordtype">int</span> subOffset;</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>    <span class="keywordtype">int</span> totalBytes = m_isb_props.app_offset;</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span> </div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>    <span class="keywordtype">int</span> verifyCheckSum = 5381;</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>    <span class="keywordtype">int</span> lineLength;</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>    <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#ab605fe2034c73d05c0dce282aafa4ade">m_update_progress</a> = 0.0f;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keywordtype">char</span> line[<a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#adb4412489ec48d32c2afeece07926ae7">HEX_BUFFER_SIZE</a>];</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> output[<a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#adb4412489ec48d32c2afeece07926ae7">HEX_BUFFER_SIZE</a> * 2]; <span class="comment">// big enough to store an entire extra line of buffer if needed</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* outputPtr = output;</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* outputPtrEnd = output + (<a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#adb4412489ec48d32c2afeece07926ae7">HEX_BUFFER_SIZE</a> * 2);</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>    <span class="keywordtype">int</span> outputSize;</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>    <span class="comment">//int page = 0;</span></div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>    <span class="keywordtype">int</span> pad;</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>    <span class="keywordtype">int</span> fileSize;</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tmp[5];</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span> </div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>    fseek(file, 0, SEEK_END);</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    fileSize = ftell(file);</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    fseek(file, 0, SEEK_SET);</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    <span class="keywordflow">while</span> ((lineLength = is_isb_read_line(file, line)) != 0)</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>    {</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        <span class="keywordflow">if</span> (lineLength &gt; 12 &amp;&amp; line[7] == <span class="charliteral">&#39;0&#39;</span> &amp;&amp; line[8] == <span class="charliteral">&#39;0&#39;</span>)</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>        {</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>            <span class="keywordflow">if</span> (lineLength &gt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#adb4412489ec48d32c2afeece07926ae7">HEX_BUFFER_SIZE</a> * 4)</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>            {</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>                <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) hex file line length too long&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>            }</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span> </div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>            <span class="comment">// we need to know the offset that this line was supposed to be stored at so we can check if offsets are skipped</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>            memcpy(tmp, line + 3, 4);</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>            tmp[4] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>            subOffset = strtol((<span class="keywordtype">char</span>*)tmp, 0, 16);</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span> </div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>            <span class="comment">// check if we skipped an offset, the intel hex file format can do this, in which case we need to make sure</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>            <span class="comment">// that the bytes that were skipped get set to something</span></div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>            <span class="keywordflow">if</span> (subOffset &gt; lastSubOffset)</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>            {</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>                <span class="comment">// pad with FF bytes, this is an internal implementation detail to how the device stores unused memory</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>                pad = (subOffset - lastSubOffset);</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>                <span class="keywordflow">if</span> (outputPtr + pad &gt;= outputPtrEnd)</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>                {</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>                    <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) FF padding overflowed buffer&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>                    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>                }</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>                <span class="keywordflow">while</span> (pad-- != 0)</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>                {</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>                    *outputPtr++ = <span class="charliteral">&#39;F&#39;</span>;</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>                    *outputPtr++ = <span class="charliteral">&#39;F&#39;</span>;</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>                }</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>            }</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span> </div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>            <span class="comment">// skip the first 9 chars which are not data, then take everything else minus the last two chars which are a checksum</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>            <span class="comment">// check for overflow</span></div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            pad = lineLength - 11;</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>            <span class="keywordflow">if</span> (outputPtr + pad &gt;= outputPtrEnd)</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>            {</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>                <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Line data overflowed output buffer&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>            }</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span> </div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>            <span class="keywordflow">for</span> (i = 9; i &lt; lineLength - 2; i++)</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>            {</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>                *outputPtr++ = line[i];</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>            }</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span> </div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>            <span class="comment">// set the end offset so we can check later for skipped offsets</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>            lastSubOffset = subOffset + ((lineLength - 11) / 2);</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>            outputSize = (int)(outputPtr - output);</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span> </div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>            <span class="comment">// we try to send the most allowed by this hex file format</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>            <span class="keywordflow">if</span> (outputSize &lt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a5ec11ef11aace0f302a1ea711388a28b">MAX_SEND_COUNT</a>)</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>            {</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>                <span class="comment">// keep buffering</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>            }</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>            <span class="comment">// upload this chunk</span></div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>            <span class="keywordflow">if</span> (upload_hex(output, <a class="code hl_define" href="_i_s_constants_8h.html#a89279935d2e2d0bcdc26cdf9e2ba5b1e">_MIN</a>(<a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a5ec11ef11aace0f302a1ea711388a28b">MAX_SEND_COUNT</a>, outputSize), &amp;currentOffset, &amp;currentPage, &amp;totalBytes, &amp;verifyCheckSum) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>            {</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>            }</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span> </div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>            outputSize -= <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a5ec11ef11aace0f302a1ea711388a28b">MAX_SEND_COUNT</a>;</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span> </div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>            <span class="keywordflow">if</span> (outputSize &lt; 0 || outputSize &gt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#adb4412489ec48d32c2afeece07926ae7">HEX_BUFFER_SIZE</a>)</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>            {</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>                <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Output size was too large (1)&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>            }</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>            <span class="keywordflow">if</span> (outputSize &gt; 0)</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>            {</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>                <span class="comment">// move the left-over data to the beginning</span></div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>                memmove(output, output + <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a5ec11ef11aace0f302a1ea711388a28b">MAX_SEND_COUNT</a>, outputSize);</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>            }</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span> </div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>            <span class="comment">// reset output ptr back to the next chunk of data</span></div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>            outputPtr = output + outputSize;</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>        }</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(line, <span class="stringliteral">&quot;:020000040&quot;</span>, 10) == 0 &amp;&amp; strlen(line) &gt;= 13)</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>        {</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>            memcpy(tmp, line + 12, 3);      <span class="comment">// Only support up to 10 pages currently</span></div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>            tmp[1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>            currentPage = strtol((<span class="keywordtype">char</span>*)tmp, 0, 16);</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span> </div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>            <span class="keywordflow">if</span>(currentPage == 0) </div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>            {</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>                lastSubOffset = currentOffset;</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>            }</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            <span class="keywordflow">else</span> </div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>            {</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>                lastSubOffset = 0;</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>            }</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>            </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>            outputSize = (int)(outputPtr - output);</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span> </div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>            <span class="keywordflow">if</span> (outputSize &lt; 0 || outputSize &gt; <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#adb4412489ec48d32c2afeece07926ae7">HEX_BUFFER_SIZE</a>)</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>            {</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>                <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Output size was too large (2)&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>            }</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>            <span class="comment">// flush the remainder of data to the page</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>            <span class="keywordflow">if</span> (upload_hex(output, outputSize, &amp;currentOffset, &amp;currentPage, &amp;totalBytes, &amp;verifyCheckSum) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>            {</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>            }</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>            <span class="comment">// // fill the remainder of the current page, the next time that bytes try to be written the page will be automatically incremented</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>            <span class="keywordflow">if</span> (fill_current_page(&amp;currentPage, &amp;currentOffset, &amp;totalBytes, &amp;verifyCheckSum) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>            {</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>            }</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span> </div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>            <span class="comment">// change to the next page</span></div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>            currentOffset = 0;</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>            <span class="keywordflow">if</span> (select_page(currentPage) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a> || begin_program_for_current_page(0, <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a> - 1) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>            {</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>                <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Failed to issue select page or to start programming&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>            }</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span> </div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>            <span class="comment">// set the output ptr back to the beginning, no more data is in the queue</span></div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>            outputPtr = output;</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>        }</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lineLength &gt; 10 &amp;&amp; line[7] == <span class="charliteral">&#39;0&#39;</span> &amp;&amp; line[8] == <span class="charliteral">&#39;1&#39;</span>)</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>        {   <span class="comment">// End of last page (end of file marker)</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>            outputSize = (int)(outputPtr - output);</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span> </div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>            <span class="comment">// flush the remainder of data to the page</span></div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>            <span class="keywordflow">if</span> (upload_hex(output, outputSize, &amp;currentOffset, &amp;currentPage, &amp;totalBytes, &amp;verifyCheckSum) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>            {</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>            }</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>            <span class="keywordflow">if</span> (currentOffset != 0 &amp;&amp; fill_current_page(&amp;currentPage, &amp;currentOffset, &amp;totalBytes, &amp;verifyCheckSum) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>            {</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>            }</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span> </div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>            outputPtr = output;</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>            </div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>        }</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span> </div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a512117853838b91bb06d7c1e4b796772">m_update_callback</a> != 0)</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>        {</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>            <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#ab605fe2034c73d05c0dce282aafa4ade">m_update_progress</a> = (float)ftell(file) / (float)fileSize;   <span class="comment">// Dummy line to call ftell() once</span></div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>            <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#ab605fe2034c73d05c0dce282aafa4ade">m_update_progress</a> = (float)ftell(file) / (float)fileSize;</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a512117853838b91bb06d7c1e4b796772">m_update_callback</a>(<span class="keyword">this</span>, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#ab605fe2034c73d05c0dce282aafa4ade">m_update_progress</a>) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>)</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>            {</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>                <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Firmware update cancelled&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">IS_LOG_LEVEL_ERROR</a>);</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a55a8bca4ef283118639d8063b715a579">IS_OP_CANCELLED</a>;</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>            }</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>        }</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>    }</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span> </div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>    <span class="comment">// upload any left over data</span></div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span><span class="comment">//    outputSize = (int)(outputPtr - output);</span></div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span><span class="comment">//    if (upload_hex(output, outputSize, &amp;currentOffset, &amp;currentPage, &amp;totalBytes, &amp;verifyCheckSum) != IS_OP_OK)</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span><span class="comment">//    {</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span><span class="comment">//        return IS_OP_ERROR;</span></div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span><span class="comment">//    }</span></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>    <span class="comment">// pad the remainder of the page with fill bytes</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>    <span class="comment">// if (currentOffset != 0 &amp;&amp; fill_current_page(&amp;currentPage, &amp;currentOffset, &amp;totalBytes, &amp;verifyCheckSum) != IS_OP_OK)</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>    <span class="comment">// {</span></div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>    <span class="comment">//     return IS_OP_ERROR;</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>    <span class="comment">// }</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span> </div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a512117853838b91bb06d7c1e4b796772">m_update_callback</a> != 0 &amp;&amp; <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#ab605fe2034c73d05c0dce282aafa4ade">m_update_progress</a> != 1.0f)</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>    {</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>        <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#ab605fe2034c73d05c0dce282aafa4ade">m_update_progress</a> = 1.0f;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>        <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a512117853838b91bb06d7c1e4b796772">m_update_callback</a>(<span class="keyword">this</span>, <a class="code hl_variable" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#ab605fe2034c73d05c0dce282aafa4ade">m_update_progress</a>);</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>    }</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span> </div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    <span class="comment">// Set the verify function up</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    m_currentPage = currentPage;</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>    m_verifyCheckSum = verifyCheckSum;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span> </div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>}</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#ad46f78bad6202bcbb91e42f6be7a97d3">  985</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#ad46f78bad6202bcbb91e42f6be7a97d3">cISBootloaderISB::download_image</a>(std::string filename)</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>{</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>    FILE* firmware_file = 0;</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span> </div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>    fopen_s(&amp;firmware_file, filename.c_str(), <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    firmware_file = fopen(filename.c_str(), <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span> </div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Erasing flash...&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span> </div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>    <span class="keywordflow">if</span>(erase_flash() != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <span class="keywordflow">if</span>(select_page(0) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span> </div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    <a class="code hl_function" href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">status_update</a>(<span class="stringliteral">&quot;(ISB) Programming flash...&quot;</span>, <a class="code hl_enumvalue" href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">IS_LOG_LEVEL_INFO</a>);</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>    </div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    <span class="keywordflow">if</span>(begin_program_for_current_page(m_isb_props.app_offset, <a class="code hl_define" href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a> - 1) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="keywordflow">if</span>(process_hex_file(firmware_file) != <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span> </div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    fclose(firmware_file);</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span> </div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>}</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span> </div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"><a class="line" href="classc_i_s_bootloader_i_s_b.html#afba06d1c7f2badca6dffb2a287635c6b"> 1010</a></span><a class="code hl_enumeration" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a> <a class="code hl_function" href="classc_i_s_bootloader_i_s_b.html#afba06d1c7f2badca6dffb2a287635c6b">cISBootloaderISB::get_version_from_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, uint8_t* major, <span class="keywordtype">char</span>* minor)</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>{</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    FILE* blfile = 0;</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span> </div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span><span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    fopen_s(&amp;blfile, filename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    blfile = fopen(filename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span> </div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    <span class="keywordflow">if</span> (blfile == 0)</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span> </div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    fseek(blfile, 0x3DFC, SEEK_SET);</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ver_info[4];</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    <span class="keywordtype">size_t</span> n = fread(ver_info, 1, 4, blfile);</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    (void)n;</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    fclose(blfile);</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span> </div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    <span class="comment">//Check for marker for valid version info</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>    <span class="keywordflow">if</span> (ver_info[0] == 0xAA &amp;&amp; ver_info[1] == 0x55)</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    {</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>        <span class="keywordflow">if</span> (major)</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>            *major = ver_info[2];</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>        <span class="keywordflow">if</span> (minor)</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>            *minor = ver_info[3];</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a>;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    }</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span> </div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    <span class="comment">//No version found</span></div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a>;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>}</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span> </div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span> </div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span> </div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span> </div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span> </div>
<div class="ttc" id="a_i_s_bootloader_i_s_b_8cpp_html_a377d602dd57c98be59f66efafe93a924"><div class="ttname"><a href="_i_s_bootloader_i_s_b_8cpp.html#a377d602dd57c98be59f66efafe93a924">BOOTLOADER_TIMEOUT_DEFAULT</a></div><div class="ttdeci">#define BOOTLOADER_TIMEOUT_DEFAULT</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00043">ISBootloaderISB.cpp:43</a></div></div>
<div class="ttc" id="a_i_s_bootloader_i_s_b_8cpp_html_a4c548c41044465fad00d24c99eeced77"><div class="ttname"><a href="_i_s_bootloader_i_s_b_8cpp.html#a4c548c41044465fad00d24c99eeced77">MAX_VERIFY_CHUNK_SIZE</a></div><div class="ttdeci">#define MAX_VERIFY_CHUNK_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00042">ISBootloaderISB.cpp:42</a></div></div>
<div class="ttc" id="a_i_s_bootloader_i_s_b_8cpp_html_a4cc14e2c99ae7f8e5a8e371d03c8532c"><div class="ttname"><a href="_i_s_bootloader_i_s_b_8cpp.html#a4cc14e2c99ae7f8e5a8e371d03c8532c">FLASH_PAGE_SIZE</a></div><div class="ttdeci">#define FLASH_PAGE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00047">ISBootloaderISB.cpp:47</a></div></div>
<div class="ttc" id="a_i_s_bootloader_i_s_b_8cpp_html_a5ec11ef11aace0f302a1ea711388a28b"><div class="ttname"><a href="_i_s_bootloader_i_s_b_8cpp.html#a5ec11ef11aace0f302a1ea711388a28b">MAX_SEND_COUNT</a></div><div class="ttdeci">#define MAX_SEND_COUNT</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00044">ISBootloaderISB.cpp:44</a></div></div>
<div class="ttc" id="a_i_s_bootloader_i_s_b_8cpp_html_a94bf881abdc00f884f3580b5b7823ede"><div class="ttname"><a href="_i_s_bootloader_i_s_b_8cpp.html#a94bf881abdc00f884f3580b5b7823ede">BOOTLOADER_RETRIES</a></div><div class="ttdeci">#define BOOTLOADER_RETRIES</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00039">ISBootloaderISB.cpp:39</a></div></div>
<div class="ttc" id="a_i_s_bootloader_i_s_b_8cpp_html_adb4412489ec48d32c2afeece07926ae7"><div class="ttname"><a href="_i_s_bootloader_i_s_b_8cpp.html#adb4412489ec48d32c2afeece07926ae7">HEX_BUFFER_SIZE</a></div><div class="ttdeci">#define HEX_BUFFER_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00776">ISBootloaderISB.cpp:776</a></div></div>
<div class="ttc" id="a_i_s_bootloader_i_s_b_8cpp_html_ae9af5fb05b7c83d516ab4683ca1faf86"><div class="ttname"><a href="_i_s_bootloader_i_s_b_8cpp.html#ae9af5fb05b7c83d516ab4683ca1faf86">BOOTLOADER_RESPONSE_DELAY</a></div><div class="ttdeci">#define BOOTLOADER_RESPONSE_DELAY</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00040">ISBootloaderISB.cpp:40</a></div></div>
<div class="ttc" id="a_i_s_bootloader_i_s_b_8h_html"><div class="ttname"><a href="_i_s_bootloader_i_s_b_8h.html">ISBootloaderISB.h</a></div><div class="ttdoc">Inertial Sense routines for updating application images using the ISB (Inertial Sense Bootloader) pro...</div></div>
<div class="ttc" id="a_i_s_constants_8h_html_a38824fbad279e2ba24e488cdba084032"><div class="ttname"><a href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032">is_operation_result</a></div><div class="ttdeci">is_operation_result</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_constants_8h_source.html#l00800">ISConstants.h:800</a></div></div>
<div class="ttc" id="a_i_s_constants_8h_html_a38824fbad279e2ba24e488cdba084032a0be7fb64dcc83728e690665d5c55c7dd"><div class="ttname"><a href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a0be7fb64dcc83728e690665d5c55c7dd">IS_OP_CLOSED</a></div><div class="ttdeci">@ IS_OP_CLOSED</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_constants_8h_source.html#l00806">ISConstants.h:806</a></div></div>
<div class="ttc" id="a_i_s_constants_8h_html_a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a"><div class="ttname"><a href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a24bf7e204f1066ecfc17680eff9a105a">IS_OP_ERROR</a></div><div class="ttdeci">@ IS_OP_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_constants_8h_source.html#l00802">ISConstants.h:802</a></div></div>
<div class="ttc" id="a_i_s_constants_8h_html_a38824fbad279e2ba24e488cdba084032a55a8bca4ef283118639d8063b715a579"><div class="ttname"><a href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a55a8bca4ef283118639d8063b715a579">IS_OP_CANCELLED</a></div><div class="ttdeci">@ IS_OP_CANCELLED</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_constants_8h_source.html#l00803">ISConstants.h:803</a></div></div>
<div class="ttc" id="a_i_s_constants_8h_html_a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41"><div class="ttname"><a href="_i_s_constants_8h.html#a38824fbad279e2ba24e488cdba084032a63769359d4dd68c942183c8bde39dc41">IS_OP_OK</a></div><div class="ttdeci">@ IS_OP_OK</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_constants_8h_source.html#l00801">ISConstants.h:801</a></div></div>
<div class="ttc" id="a_i_s_constants_8h_html_a770571e12ff9370899184528f4b4626d"><div class="ttname"><a href="_i_s_constants_8h.html#a770571e12ff9370899184528f4b4626d">SNPRINTF</a></div><div class="ttdeci">#define SNPRINTF</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_constants_8h_source.html#l00150">ISConstants.h:150</a></div></div>
<div class="ttc" id="a_i_s_constants_8h_html_a89279935d2e2d0bcdc26cdf9e2ba5b1e"><div class="ttname"><a href="_i_s_constants_8h.html#a89279935d2e2d0bcdc26cdf9e2ba5b1e">_MIN</a></div><div class="ttdeci">#define _MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_constants_8h_source.html#l00300">ISConstants.h:300</a></div></div>
<div class="ttc" id="a_i_s_utilities_8h_html"><div class="ttname"><a href="_i_s_utilities_8h.html">ISUtilities.h</a></div></div>
<div class="ttc" id="a_i_s_utilities_8h_html_a038783cd27cbb54e9c8d8708f147168e"><div class="ttname"><a href="_i_s_utilities_8h.html#a038783cd27cbb54e9c8d8708f147168e">SLEEP_MS</a></div><div class="ttdeci">#define SLEEP_MS(timeMs)</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_utilities_8h_source.html#l00142">ISUtilities.h:142</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_a4c54e9c0da011002da30950ffe7eee18"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a4c54e9c0da011002da30950ffe7eee18">ISBootloader::cISBootloaderBase::status_update</a></div><div class="ttdeci">void status_update(const char *info, eLogLevel level)</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00283">ISBootloaderBase.h:283</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_a512117853838b91bb06d7c1e4b796772"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a512117853838b91bb06d7c1e4b796772">ISBootloader::cISBootloaderBase::m_update_callback</a></div><div class="ttdeci">pfnBootloadProgress m_update_callback</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00205">ISBootloaderBase.h:205</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_a5dd3052c83e7c7aa84d17579aaba6d49"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a5dd3052c83e7c7aa84d17579aaba6d49">ISBootloader::cISBootloaderBase::m_info_callback</a></div><div class="ttdeci">pfnBootloadStatus m_info_callback</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00207">ISBootloaderBase.h:207</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_a66087757bf0a16f402c5274f83e7b942"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a66087757bf0a16f402c5274f83e7b942">ISBootloader::cISBootloaderBase::m_isb_major</a></div><div class="ttdeci">uint8_t m_isb_major</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00220">ISBootloaderBase.h:220</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_a6fe1da33fc0010a08a7c2670e95d7827"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a6fe1da33fc0010a08a7c2670e95d7827">ISBootloader::cISBootloaderBase::m_verify_callback</a></div><div class="ttdeci">pfnBootloadProgress m_verify_callback</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00206">ISBootloaderBase.h:206</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_a8896f0fe990b381c6d4a3adc75702bbd"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8896f0fe990b381c6d4a3adc75702bbd">ISBootloader::cISBootloaderBase::m_verify_progress</a></div><div class="ttdeci">float m_verify_progress</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00200">ISBootloaderBase.h:200</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_a8e5249771d69407f8e872344bac38a7a"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#a8e5249771d69407f8e872344bac38a7a">ISBootloader::cISBootloaderBase::m_isb_minor</a></div><div class="ttdeci">char m_isb_minor</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00221">ISBootloaderBase.h:221</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_aa7df04cbf82eb979e701f66fa0e76b5a"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#aa7df04cbf82eb979e701f66fa0e76b5a">ISBootloader::cISBootloaderBase::m_sn</a></div><div class="ttdeci">uint32_t m_sn</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00219">ISBootloaderBase.h:219</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_ab605fe2034c73d05c0dce282aafa4ade"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#ab605fe2034c73d05c0dce282aafa4ade">ISBootloader::cISBootloaderBase::m_update_progress</a></div><div class="ttdeci">float m_update_progress</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00199">ISBootloaderBase.h:199</a></div></div>
<div class="ttc" id="aclass_i_s_bootloader_1_1c_i_s_bootloader_base_html_adcb58509c31503d914aa2a25d4da592c"><div class="ttname"><a href="class_i_s_bootloader_1_1c_i_s_bootloader_base.html#adcb58509c31503d914aa2a25d4da592c">ISBootloader::cISBootloaderBase::m_port</a></div><div class="ttdeci">serial_port_t * m_port</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00215">ISBootloaderBase.h:215</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_a20abf8c77cb3ea4b04ba9adef741966e"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#a20abf8c77cb3ea4b04ba9adef741966e">cISBootloaderISB::verify_image</a></div><div class="ttdeci">is_operation_result verify_image(std::string image)</div><div class="ttdoc">Verify an image against the device.</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00630">ISBootloaderISB.cpp:630</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_a21f99422a8fd1cfb15302119cd701040"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#a21f99422a8fd1cfb15302119cd701040">cISBootloaderISB::processor</a></div><div class="ttdeci">ISBootloader::eProcessorType processor</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8h_source.html#l00112">ISBootloaderISB.h:112</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_a2af077bc4a546b9b5d47f12aa1378a37"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#a2af077bc4a546b9b5d47f12aa1378a37">cISBootloaderISB::reboot_down</a></div><div class="ttdeci">is_operation_result reboot_down(uint8_t major=0, char minor=0, bool force=false)</div><div class="ttdoc">Reboots into the level below, if available:</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00146">ISBootloaderISB.cpp:146</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_a40149f71f4c103772dfba7c15e784a95"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#a40149f71f4c103772dfba7c15e784a95">cISBootloaderISB::reboot_force</a></div><div class="ttdeci">is_operation_result reboot_force()</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00199">ISBootloaderISB.cpp:199</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_a6efb9ac812178df4804179d6232e2d32"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#a6efb9ac812178df4804179d6232e2d32">cISBootloaderISB::check_is_compatible</a></div><div class="ttdeci">ISBootloader::eImageSignature check_is_compatible()</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00061">ISBootloaderISB.cpp:61</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_a8449e25b750d909130a2a85ac9530f14"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#a8449e25b750d909130a2a85ac9530f14">cISBootloaderISB::match_test</a></div><div class="ttdeci">is_operation_result match_test(void *param)</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00049">ISBootloaderISB.cpp:49</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_ac4ff1b5dd6003b735be8762bfcfbfd7e"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#ac4ff1b5dd6003b735be8762bfcfbfd7e">cISBootloaderISB::reboot_up</a></div><div class="ttdeci">is_operation_result reboot_up()</div><div class="ttdoc">Reboots into the level above, if available:</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00136">ISBootloaderISB.cpp:136</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_accf8ffbc948927a3779851c520f2bf99"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#accf8ffbc948927a3779851c520f2bf99">cISBootloaderISB::reboot</a></div><div class="ttdeci">is_operation_result reboot()</div><div class="ttdoc">Reboots into the same mode, giving the bootloader a fresh start.</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00210">ISBootloaderISB.cpp:210</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_ad46f78bad6202bcbb91e42f6be7a97d3"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#ad46f78bad6202bcbb91e42f6be7a97d3">cISBootloaderISB::download_image</a></div><div class="ttdeci">is_operation_result download_image(std::string image)</div><div class="ttdoc">Write an image to the device.</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00985">ISBootloaderISB.cpp:985</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_aed4542322cadca025f0bcf58be54c02a"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#aed4542322cadca025f0bcf58be54c02a">cISBootloaderISB::sync</a></div><div class="ttdeci">static is_operation_result sync(serial_port_t *s)</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00301">ISBootloaderISB.cpp:301</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_afa1f47550416d2c71b4f0df83c6bf33c"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#afa1f47550416d2c71b4f0df83c6bf33c">cISBootloaderISB::get_device_info</a></div><div class="ttdeci">uint32_t get_device_info()</div><div class="ttdoc">Get the serial number from the device, and fill out m_ctx with other info.</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l00235">ISBootloaderISB.cpp:235</a></div></div>
<div class="ttc" id="aclassc_i_s_bootloader_i_s_b_html_afba06d1c7f2badca6dffb2a287635c6b"><div class="ttname"><a href="classc_i_s_bootloader_i_s_b.html#afba06d1c7f2badca6dffb2a287635c6b">cISBootloaderISB::get_version_from_file</a></div><div class="ttdeci">static is_operation_result get_version_from_file(const char *filename, uint8_t *major, char *minor)</div><div class="ttdoc">Gets the version (e.g. 6a) from the bootloader file. Should be used in conjunction with the function ...</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_i_s_b_8cpp_source.html#l01010">ISBootloaderISB.cpp:1010</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html"><div class="ttname"><a href="namespace_i_s_bootloader.html">ISBootloader</a></div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00031">ISBootloaderBase.h:31</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42"><div class="ttname"><a href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eac6bb7e77bab0163143a8123dac433c42">ISBootloader::IS_LOG_LEVEL_ERROR</a></div><div class="ttdeci">@ IS_LOG_LEVEL_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00038">ISBootloaderBase.h:38</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0"><div class="ttname"><a href="namespace_i_s_bootloader.html#a2bb0e8fcbcce3f4a7594efd70a9d436eaf2895d061f33e132ae9d7d3ae171c9f0">ISBootloader::IS_LOG_LEVEL_INFO</a></div><div class="ttdeci">@ IS_LOG_LEVEL_INFO</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00040">ISBootloaderBase.h:40</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_a80a59119a7a9a9b8675b4b7a31cf5ba6"><div class="ttname"><a href="namespace_i_s_bootloader.html#a80a59119a7a9a9b8675b4b7a31cf5ba6">ISBootloader::eProcessorType</a></div><div class="ttdeci">eProcessorType</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00053">ISBootloaderBase.h:53</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_a80a59119a7a9a9b8675b4b7a31cf5ba6ada8b6a1944bdcffbd13c86732ded6b84"><div class="ttname"><a href="namespace_i_s_bootloader.html#a80a59119a7a9a9b8675b4b7a31cf5ba6ada8b6a1944bdcffbd13c86732ded6b84">ISBootloader::IS_PROCESSOR_SAMx70</a></div><div class="ttdeci">@ IS_PROCESSOR_SAMx70</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00054">ISBootloaderBase.h:54</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_a80a59119a7a9a9b8675b4b7a31cf5ba6af7b5cee53c43708d1eba5a8bed0d120c"><div class="ttname"><a href="namespace_i_s_bootloader.html#a80a59119a7a9a9b8675b4b7a31cf5ba6af7b5cee53c43708d1eba5a8bed0d120c">ISBootloader::IS_PROCESSOR_STM32L4</a></div><div class="ttdeci">@ IS_PROCESSOR_STM32L4</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00055">ISBootloaderBase.h:55</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2">ISBootloader::eImageSignature</a></div><div class="ttdeci">eImageSignature</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00060">ISBootloaderBase.h:60</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2a08be4861f1cb10537584ee03f649906c"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a08be4861f1cb10537584ee03f649906c">ISBootloader::IS_IMAGE_SIGN_EVB_2_24K</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_EVB_2_24K</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00069">ISBootloaderBase.h:69</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2a21a7f735341610339d34fa49762357a0"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a21a7f735341610339d34fa49762357a0">ISBootloader::IS_IMAGE_SIGN_UINS_3_24K</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_UINS_3_24K</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00067">ISBootloaderBase.h:67</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2a48ec64d1b2f09273e78b930b18e0c10f"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a48ec64d1b2f09273e78b930b18e0c10f">ISBootloader::IS_IMAGE_SIGN_EVB_2_16K</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_EVB_2_16K</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00068">ISBootloaderBase.h:68</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2a51902124186404747dd01bf070335611"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a51902124186404747dd01bf070335611">ISBootloader::IS_IMAGE_SIGN_UINS_3_16K</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_UINS_3_16K</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00066">ISBootloaderBase.h:66</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2a890a0460e8a110e1ee31c8e729fb1d31"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a890a0460e8a110e1ee31c8e729fb1d31">ISBootloader::IS_IMAGE_SIGN_NONE</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_NONE</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00081">ISBootloaderBase.h:81</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2a8d81bf1df4e358eb283f577f9738dc1b"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2a8d81bf1df4e358eb283f577f9738dc1b">ISBootloader::IS_IMAGE_SIGN_ISB_SAMx70_24K</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_ISB_SAMx70_24K</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00064">ISBootloaderBase.h:64</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2aedaebacf879f9f8dd45d02421b93edd0"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2aedaebacf879f9f8dd45d02421b93edd0">ISBootloader::IS_IMAGE_SIGN_UINS_5</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_UINS_5</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00070">ISBootloaderBase.h:70</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2af101394417d121c078a4056c5aae9651"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2af101394417d121c078a4056c5aae9651">ISBootloader::IS_IMAGE_SIGN_ISB_SAMx70_16K</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_ISB_SAMx70_16K</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00063">ISBootloaderBase.h:63</a></div></div>
<div class="ttc" id="anamespace_i_s_bootloader_html_aefa5ac0c1c1690333b1c17ec7fa4f6d2afe5985f982c044f693cc6140a4815462"><div class="ttname"><a href="namespace_i_s_bootloader.html#aefa5ac0c1c1690333b1c17ec7fa4f6d2afe5985f982c044f693cc6140a4815462">ISBootloader::IS_IMAGE_SIGN_ISB_STM32L4</a></div><div class="ttdeci">@ IS_IMAGE_SIGN_ISB_STM32L4</div><div class="ttdef"><b>Definition:</b> <a href="_i_s_bootloader_base_8h_source.html#l00062">ISBootloaderBase.h:62</a></div></div>
<div class="ttc" id="aserial_port_8c_html_a25ebaeafcc060a447ec1a38a8085943d"><div class="ttname"><a href="serial_port_8c.html#a25ebaeafcc060a447ec1a38a8085943d">serialPortClose</a></div><div class="ttdeci">int serialPortClose(serial_port_t *serialPort)</div><div class="ttdef"><b>Definition:</b> <a href="serial_port_8c_source.html#l00066">serialPort.c:66</a></div></div>
<div class="ttc" id="aserial_port_8c_html_a315998701c41541c53f4041b4e3f8403"><div class="ttname"><a href="serial_port_8c.html#a315998701c41541c53f4041b4e3f8403">serialPortWriteAndWaitForTimeout</a></div><div class="ttdeci">int serialPortWriteAndWaitForTimeout(serial_port_t *serialPort, const unsigned char *buffer, int writeCount, const unsigned char *waitFor, int waitForLength, const int timeoutMilliseconds)</div><div class="ttdef"><b>Definition:</b> <a href="serial_port_8c_source.html#l00286">serialPort.c:286</a></div></div>
<div class="ttc" id="aserial_port_8c_html_a7426c48831273ec45889f652623d00df"><div class="ttname"><a href="serial_port_8c.html#a7426c48831273ec45889f652623d00df">serialPortReadTimeout</a></div><div class="ttdeci">int serialPortReadTimeout(serial_port_t *serialPort, unsigned char *buffer, int readCount, int timeoutMilliseconds)</div><div class="ttdef"><b>Definition:</b> <a href="serial_port_8c_source.html#l00089">serialPort.c:89</a></div></div>
<div class="ttc" id="aserial_port_8c_html_aaef9e6973f9dfd121a4eb87b7a13542e"><div class="ttname"><a href="serial_port_8c.html#aaef9e6973f9dfd121a4eb87b7a13542e">serialPortWaitForTimeout</a></div><div class="ttdeci">int serialPortWaitForTimeout(serial_port_t *serialPort, const unsigned char *waitFor, int waitForLength, int timeoutMilliseconds)</div><div class="ttdef"><b>Definition:</b> <a href="serial_port_8c_source.html#l00308">serialPort.c:308</a></div></div>
<div class="ttc" id="aserial_port_8c_html_ad2240e52502e49f931504565cc1d39d0"><div class="ttname"><a href="serial_port_8c.html#ad2240e52502e49f931504565cc1d39d0">serialPortWrite</a></div><div class="ttdeci">int serialPortWrite(serial_port_t *serialPort, const unsigned char *buffer, int writeCount)</div><div class="ttdef"><b>Definition:</b> <a href="serial_port_8c_source.html#l00201">serialPort.c:201</a></div></div>
<div class="ttc" id="aserial_port_8c_html_af4b519e1c32d49d8937677b4b62ea99d"><div class="ttname"><a href="serial_port_8c.html#af4b519e1c32d49d8937677b4b62ea99d">serialPortFlush</a></div><div class="ttdeci">int serialPortFlush(serial_port_t *serialPort)</div><div class="ttdef"><b>Definition:</b> <a href="serial_port_8c_source.html#l00075">serialPort.c:75</a></div></div>
<div class="ttc" id="astructserial__port__t_html"><div class="ttname"><a href="structserial__port__t.html">serial_port_t</a></div><div class="ttdef"><b>Definition:</b> <a href="serial_port_8h_source.html#l00064">serialPort.h:65</a></div></div>
<div class="ttc" id="astructserial__port__t_html_ae78066c31c9a5100228570d53e7fbec5"><div class="ttname"><a href="structserial__port__t.html#ae78066c31c9a5100228570d53e7fbec5">serial_port_t::port</a></div><div class="ttdeci">char port[MAX_SERIAL_PORT_NAME_LENGTH+1]</div><div class="ttdef"><b>Definition:</b> <a href="serial_port_8h_source.html#l00070">serialPort.h:70</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
